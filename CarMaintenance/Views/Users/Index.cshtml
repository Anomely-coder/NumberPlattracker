@model List<CarMaintenance.Models.Users>
@inject Microsoft.Extensions.Localization.IStringLocalizer<SharedResource> Localizer
@using System.Globalization

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- Debug: This is Views/Users/Index.cshtml -->
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>@Localizer["UsersTitle"]</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-@(CultureInfo.CurrentCulture.TextInfo.IsRightToLeft ? "left" : "right")">
                    <li class="breadcrumb-item">
                        <a asp-action="Index" asp-controller="Home">@Localizer["HomeLink"]</a>
                    </li>
                    <li class="breadcrumb-item active">@Localizer["UsersBreadcrumb"]</li>
                </ol>
            </div>
        </div>
    </div>
</section>

<section class="content">
    <div class="container-fluid">
        @if (TempData["Message"] != null)
        {
            <div class="alert alert-success alert-dismissible">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                @TempData["Message"]
            </div>
        }
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">@Localizer["CurrentUsersTitle"]</h3>
                <div class="card-tools">
                    <a asp-action="AddUser" asp-controller="Users" class="btn btn-primary btn-sm">@Localizer["AddNewUserButton"]</a>
                </div>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>@Localizer["Name"]</th>
                            <th>@Localizer["EmailLabel"]</th>
                            <th>@Localizer["DateAddedColumn"]</th>
                            <th>@Localizer["LastLoginColumn"]</th>
                            <th>@Localizer["PasswordStatusColumn"]</th>
                            <th>@Localizer["ActionsColumn"]</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var user in Model)
                            {
                                bool isExpired = user.PasswordLastChanged.HasValue &&
                                (DateTime.Now - user.PasswordLastChanged.Value).TotalDays > 61;
                                <tr>
                                    <td>@user.FirstName @user.LastName</td>
                                    <td>@user.Email</td>
                                    <td>@user.CreatedAt.ToString("dd/MM/yyyy HH:mm:ss")</td>
                                    <td>@(user.LastLogin.HasValue? user.LastLogin.Value.ToString("dd/MM/yyyy HH:mm:ss") : Localizer["NeverText"])</td>
                                    <td>@(isExpired? Localizer["ExpiredText"] : Localizer["ValidText"])</td>
                                    <td>
                                        <a asp-action="EditUser" asp-controller="Users" asp-route-Id="@user.UserID" class="btn btn-sm btn-warning">@Localizer["EditButton"]</a>
                                        <a asp-action="DeleteUser" asp-controller="Users" asp-route-Id="@user.UserID" class="btn btn-sm btn-danger" onclick="return confirm('@Localizer["DeleteConfirmMessage"]');">@Localizer["DeleteButton"]</a>
                                        <a asp-action="ResetPassword" asp-controller="Users" asp-route-Id="@user.UserID" class="btn btn-sm btn-info" onclick="return confirm('@Localizer["ResetPasswordConfirmMessage", user.Email]');">@Localizer["ResetPasswordButton"]</a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="6">@Localizer["NoUsersFound"]</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>
