@model List<CarMaintenance.Models.Users>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<!-- Debug: This is Views/Users/Index.cshtml -->
<section class="content-header">
    <div class="container-fluid">
        <div class="row mb-2">
            <div class="col-sm-6">
                <h1>Users</h1>
            </div>
            <div class="col-sm-6">
                <ol class="breadcrumb float-sm-right">
                    <li class="breadcrumb-item"><a asp-action="Index" asp-controller="Home">Home</a></li>
                    <li class="breadcrumb-item active">Users</li>
                </ol>
            </div>
        </div>
    </div>
</section>

<section class="content">
    <div class="container-fluid">
        @if (TempData["Message"] != null)
        {
            <div class="alert alert-success alert-dismissible">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                @TempData["Message"]
            </div>
        }
        <div class="card">
            <div class="card-header">
                <h3 class="card-title">Current Users</h3>
                <div class="card-tools">
                    <a asp-action="AddUser" asp-controller="Users" class="btn btn-primary btn-sm">Add New User</a>
                </div>
            </div>
            <div class="card-body">
                <table class="table table-bordered table-striped">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Date & Time Added</th>
                            <th>Last Login</th>
                            <th>Password Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        @if (Model != null && Model.Any())
                        {
                            foreach (var user in Model)
                            {
                                bool isExpired = user.PasswordLastChanged.HasValue &&
                                (DateTime.Now - user.PasswordLastChanged.Value).TotalDays > 61;
                                <tr>
                                    <td>@user.FirstName @user.LastName</td>
                                    <td>@user.Email</td>
                                    <td>@user.CreatedAt.ToString("dd/MM/yyyy HH:mm:ss")</td>
                                    <td>@(user.LastLogin.HasValue? user.LastLogin.Value.ToString("dd/MM/yyyy HH:mm:ss") : "Never")</td>
                                    <td>@(isExpired ? "Expired" : "Valid")</td>
                                    <td>
                                        <a asp-action="EditUser" asp-controller="Users" asp-route-Id="@user.UserID" class="btn btn-sm btn-warning">Edit</a>
                                        <a asp-action="DeleteUser" asp-controller="Users" asp-route-Id="@user.UserID" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this user?');">Delete</a>
                                        <a asp-action="ResetPassword" asp-controller="Users" asp-route-Id="@user.UserID" class="btn btn-sm btn-info" onclick="return confirm('Are you sure you want to reset the password for @user.Email?');">Reset Password</a>
                                    </td>
                                </tr>
                            }
                        }
                        else
                        {
                            <tr>
                                <td colspan="6">No users found.</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</section>